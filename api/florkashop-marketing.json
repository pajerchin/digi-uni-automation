{
	"info": {
		"_postman_id": "218c60fa-8086-481b-8550-d574c36500ad",
		"name": "Florkashop",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "11982828"
	},
	"item": [
		{
			"name": "check sitemap xml",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"let jsonObject = xml2Json(responseBody);",
							"let sitemap = jsonObject.sitemapindex.sitemap",
							"let loc = []",
							"",
							"sitemap.forEach(sitemap => {",
							"    loc.push(sitemap.loc)",
							"})",
							"",
							"loc.forEach(url => {",
							"",
							"    const reqInfo = {",
							"        url: url,",
							"        method: 'HEAD'",
							"    }",
							"",
							"    pm.test('Test sitemap.xml: ' + reqInfo.url , () => {",
							"        pm.sendRequest(reqInfo, (err, res) => {",
							"",
							"            pm.expect(res.code).to.equal(200, `status code is: ${res.code}`)",
							"            pm.expect(res.status).is.equal('OK')",
							"        })",
							"    })",
							"})",
							"     "
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}/sitemap_index.xml",
					"host": [
						"{{url}}"
					],
					"path": [
						"sitemap_index.xml"
					]
				}
			},
			"response": []
		},
		{
			"name": "check products xml",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"let jsonObject = xml2Json(responseBody);",
							"let url = jsonObject.urlset.url",
							"let loc = []",
							"",
							"url.forEach(sitemap => {",
							"    loc.push(sitemap.loc)",
							"})",
							"",
							"pm.collectionVariables.set('productsUrl', loc)",
							"",
							"loc.forEach(url => {",
							"",
							"    const reqInfo = {",
							"        url: url,",
							"        method: 'HEAD'",
							"    }",
							"",
							"    pm.test('Test sitemap.xml: ' + reqInfo.url , () => {",
							"        pm.sendRequest(reqInfo, (err, res) => {",
							"",
							"            pm.expect(res.code).to.equal(200, `status code is: ${res.code}`)",
							"            pm.expect(res.status).is.equal('OK')",
							"        })",
							"    })",
							"})",
							"     "
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}/product-sitemap.xml",
					"host": [
						"{{url}}"
					],
					"path": [
						"product-sitemap.xml"
					]
				}
			},
			"response": []
		},
		{
			"name": "check categories xml",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"let jsonObject = xml2Json(responseBody);",
							"let url = jsonObject.urlset.url",
							"let loc = []",
							"",
							"url.forEach(sitemap => {",
							"    loc.push(sitemap.loc)",
							"})",
							"",
							"loc.forEach(url => {",
							"",
							"    const reqInfo = {",
							"        url: url,",
							"        method: 'HEAD'",
							"    }",
							"",
							"    pm.test('Test sitemap.xml: ' + reqInfo.url , () => {",
							"        pm.sendRequest(reqInfo, (err, res) => {",
							"",
							"            pm.expect(res.code).to.equal(200, `status code is: ${res.code}`)",
							"            pm.expect(res.status).is.equal('OK')",
							"        })",
							"    })",
							"})",
							"     "
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}/product_cat-sitemap.xml",
					"host": [
						"{{url}}"
					],
					"path": [
						"product_cat-sitemap.xml"
					]
				}
			},
			"response": []
		},
		{
			"name": "check pages xml",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"let jsonObject = xml2Json(responseBody);",
							"let url = jsonObject.urlset.url",
							"let loc = []",
							"",
							"url.forEach(sitemap => {",
							"    loc.push(sitemap.loc)",
							"})",
							"",
							"pm.collectionVariables.set('pagesUrl', loc)",
							"",
							"loc.forEach(url => {",
							"",
							"    const reqInfo = {",
							"        url: url,",
							"        method: 'HEAD'",
							"    }",
							"",
							"    pm.test('Test sitemap.xml: ' + reqInfo.url , () => {",
							"        pm.sendRequest(reqInfo, (err, res) => {",
							"",
							"            pm.expect(res.code).to.equal(200, `status code is: ${res.code}`)",
							"            pm.expect(res.status).is.equal('OK')",
							"        })",
							"    })",
							"})",
							"    "
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}/page-sitemap.xml",
					"host": [
						"{{url}}"
					],
					"path": [
						"page-sitemap.xml"
					]
				}
			},
			"response": []
		},
		{
			"name": "check robots.txt",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const robots = pm.response.text().split('\\r\\n')",
							"",
							"pm.test('check disallow bin data', () => {",
							"    pm.expect(robots).to.include('Disallow: /cgi-bin/', 'cgi bin missing')",
							"})",
							"",
							"pm.test('check disallow wp-admin data', () => {",
							"    pm.expect(robots).to.include('Disallow: /wp-admin/', 'wp admin missing')",
							"})",
							"",
							"pm.test('check disallow recommended data', () => {",
							"    pm.expect(robots).to.include('Disallow: /recommended/', 'recommended missing')",
							"})",
							"",
							"pm.test('check disallow comments feed data', () => {",
							"    pm.expect(robots).to.include('Disallow: /comments/feed/', 'comments feed')",
							"})",
							"",
							"pm.test('check disallow trackback data', () => {",
							"    pm.expect(robots).to.include('Disallow: /trackback/', 'trackback')",
							"})",
							"",
							"pm.test('check disallow index.php data', () => {",
							"    pm.expect(robots).to.include('Disallow: /index.php', 'index.php missing')",
							"})",
							"",
							"pm.test('check disallow xmlrpc data', () => {",
							"    pm.expect(robots).to.include('Disallow: /xmlrpc.php', 'xmlrpc.php missing')",
							"})",
							"",
							"pm.test('check disallow wp-content data', () => {",
							"    pm.expect(robots).to.include('Disallow: /wp-content/', 'wp-content missing')",
							"})",
							"",
							"pm.test('check disallow kosik data', () => {",
							"    pm.expect(robots).to.include('Disallow: /kosik/', 'kosik missing')",
							"})",
							"",
							"pm.test('check disallow pokladna data', () => {",
							"    pm.expect(robots).to.include('Disallow: /pokladna/', 'pokladna missing')",
							"})",
							"",
							"// pm.test('check disallow moj-ucet data', () => {",
							"//     pm.expect(robots).to.include('Disallow: /moj-ucet/', 'moj ucet missing')",
							"// })",
							"",
							"pm.test('check disallow wp-login data', () => {",
							"    pm.expect(robots).to.include('Disallow: /wp-login.php', 'wp-login.php missing')",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}/robots.txt",
					"host": [
						"{{url}}"
					],
					"path": [
						"robots.txt"
					]
				}
			},
			"response": []
		},
		{
			"name": "check meta description/title",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const urlProduct = pm.collectionVariables.get('productsUrl')",
							"const urlPage = pm.collectionVariables.get('pagesUrl')",
							"",
							"const mergerUrl = urlProduct.concat(urlPage)",
							"",
							"mergerUrl.forEach(url => {",
							"    const reqInfo = {",
							"        url: url,",
							"        method: 'GET'",
							"    }",
							"",
							"    pm.sendRequest(reqInfo, (err, res) => {",
							"        const $ = cheerio.load(res.text());",
							"",
							"        const lengtDescription = $('meta[name=\"description\"]').attr('content').length",
							"        const lengthTitle = $('title').text().length",
							"",
							"        pm.test(`Meta description url: ${reqInfo.url} is length than 160 characters`, () => {",
							"            pm.expect(lengtDescription).is.lessThan(160)",
							"        })",
							"",
							"        pm.test(`Title url: ${reqInfo.url} is length than 60 characters`, () => {",
							"            pm.expect(lengthTitle).is.lessThan(60)",
							"        })",
							"",
							"    })",
							"    ",
							"})",
							"",
							"",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}",
					"host": [
						"{{url}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "check ssl certificate",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Web has ssl certificate', () => {",
							"    pm.expect(pm.request.url.protocol).is.equal('https')",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}",
					"host": [
						"{{url}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "check internal links",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const $ = cheerio.load(pm.response.text());",
							"let urlArray = []",
							"",
							"$('a[href*=\"florkashop\"]').each(function() {",
							"    let link = $(this).attr('href')",
							"",
							"    urlArray.push(link)",
							"",
							"})",
							"    ",
							"function _series (tasks, cb, currOperation = 0, results = []) {",
							"",
							"    if (currOperation === tasks.length) {",
							"        return cb(null, results);",
							"    }",
							"",
							"    if (typeof tasks[currOperation] !== 'function') {",
							"        return cb(new Error('asyncSeries: Please provide a function'));",
							"    }",
							"",
							"    tasks[currOperation]((err, res) => {",
							"        if (err) {",
							"            return cb(err);",
							"        }",
							"",
							"        results.push(res);",
							"",
							"        return _series(tasks, cb, currOperation + 1, results);",
							"    });",
							"}",
							"",
							"function asyncSeries (tasks, cb = () => {}) {",
							"    return _series(tasks, cb);",
							"}",
							"",
							"asyncSeries(urlArray.map((url) => (cb) => pm.sendRequest({ url, method: 'HEAD' }, cb)), (error, responses) => {",
							"    let errorArray = []",
							"",
							"    if(error === null) {",
							"        pm.test('Error array is empty', () => {",
							"            pm.expect(error).to.eql(null)",
							"        })",
							"    }",
							"",
							"    responses.forEach((response, index) => {",
							"        ",
							"        if(response.code !== 200) {",
							"            errorArray.push(urlArray[index]) ",
							"        }",
							"",
							"        pm.test(`Test url: ${urlArray[index]}`, () => {",
							"            pm.expect(response.code).is.equal(200)",
							"        })",
							"    });",
							"",
							"    console.warn(errorArray.join('\\n'))",
							"});",
							"",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}",
					"host": [
						"{{url}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "check hreflang",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const $ = cheerio.load(pm.response.text());",
							"",
							"const hreflang = $('link[hreflang]').attr('hreflang')",
							"",
							"pm.test('Hreflang is equal SK', () => {",
							"    pm.expect(hreflang).is.equal('sk-SK')",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}",
					"host": [
						"{{url}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "check canonical",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const filterUrls = [",
							"    '/sirupy/?orderby=popularity',",
							"    'sirupy/?orderby=rating',",
							"    '/sirupy/?orderby=date',",
							"    '/sirupy/?orderby=price',",
							"    '/sirupy/?orderby=price-desc'",
							"]",
							"",
							"const canonical = 'https://www.florkashop.sk/sirupy/'",
							"",
							"filterUrls.forEach(url => {",
							"    const reqInfo = {",
							"        url: pm.environment.get('url') + url,",
							"        method: 'GET'",
							"    }",
							"",
							"    pm.sendRequest(reqInfo, (err, res) => {",
							"        const $ = cheerio.load(res.text());",
							"",
							"        const canonicalLink = $('link[rel=\"canonical\"]').attr('href')",
							"",
							"        pm.test(`Filter ${url.split('?')[1]} has canonical ${canonicalLink}`, () => {",
							"            pm.expect(canonicalLink).is.equal(canonical)",
							"        })",
							"    })",
							"",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}",
					"host": [
						"{{url}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "chek h1",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const urlProduct = pm.collectionVariables.get('productsUrl')",
							"const urlPage = pm.collectionVariables.get('pagesUrl')",
							"",
							"const mergerUrl = urlProduct.concat(urlPage)",
							"",
							"mergerUrl.forEach(url => {",
							"    const reqInfo = {",
							"        url: url,",
							"        method: 'GET'",
							"    }",
							"",
							"    pm.sendRequest(reqInfo, (err, res) => {",
							"        const $ = cheerio.load(res.text());",
							"",
							"        const h1 = $('h1').length",
							"",
							"        pm.test(`H1 count on page ${url} is max one`, () => {",
							"            pm.expect(h1).is.lessThan(2)",
							"        })",
							"",
							"    })",
							"    ",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}",
					"host": [
						"{{url}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "check alt img",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const $ = cheerio.load(pm.response.text()); ",
							"",
							"console.log($('img').attr('alt'))",
							"",
							"$('img').each(function() {",
							"    let alternateText = $(this).attr('alt')",
							"",
							"    pm.test('Img has alternate text', () => {",
							"        pm.expect(alternateText).is.not.empty",
							"    })",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}",
					"host": [
						"{{url}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "check meta tag robots",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const urls = [",
							"    '/moj-ucet/',",
							"    '/moj-ucet/wishlist/',",
							"    '/moj-ucet/lost-password/'",
							"]",
							"",
							"urls.forEach(url => {",
							"",
							"    const reqInfo = {",
							"        url: pm.environment.get('url') + url,",
							"        method: 'GET'",
							"    }",
							"   ",
							"    pm.sendRequest(reqInfo, (err, res) => {",
							"        const $ = cheerio.load(res.text());",
							"",
							"        const robots = $('meta[name=\"robots\"]').attr('content')",
							"",
							"        pm.test(`Meta tag robots contain noindex`, () => {",
							"            pm.expect(robots).to.contain('noindex')",
							"        })",
							"    })",
							"",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}",
					"host": [
						"{{url}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "check 404 redirect",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const $ = cheerio.load(pm.response.text());",
							"const title = $('title').text()",
							"",
							"pm.test('Title contains sirupy', () => {",
							"    pm.expect(title).to.contain('Sirupy')",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{url}}/produkt/pupava/",
					"host": [
						"{{url}}"
					],
					"path": [
						"produkt",
						"pupava",
						""
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"pm.test(\"Status code is 200\", ()=> {",
					"    pm.expect(pm.response.code).to.equal(200);",
					"})",
					"",
					"pm.test('Response must be valid', ()=> {",
					"    pm.expect(pm.response.to.be.ok)",
					"})",
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "prodUrl",
			"value": "www.florkashop.sk",
			"type": "string"
		},
		{
			"key": "productsUrl",
			"value": ""
		},
		{
			"key": "pagesUrl",
			"value": ""
		}
	]
}